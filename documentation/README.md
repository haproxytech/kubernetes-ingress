
# ![HAProxy](../assets/images/haproxy-weblogo-210x49.png "HAProxy")

## HAProxy kubernetes ingress controller

Options for starting controller can be found in [controller.md](controller.md)

This is autogenerated from [doc.yaml](doc.yaml). Description can be found in [generator readme](gen/README.md)

### Available annotations

> :information_source: Ingress and service annotations can have `ingress.kubernetes.io`, `haproxy.org` and `haproxy.com` prefixes
>
> Example: haproxy.com/ssl-redirect` and `haproxy.org/ssl-redirect` are same annotation

| Annotation | Type | Default | Dependencies | Config map | Ingress | Service |
| - |:-:|:-:|:-:|:-:|:-:|:-:|
| [auth-type](#authentication) :construction:(dev) | string |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [auth-secret](#authentication) :construction:(dev) | string |  | auth-type |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [blacklist](#access-control) | IPs or CIDRs |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [check](#backend-checks) | [bool](#bool) | "true" |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [check-http](#backend-checks) | string |  | check |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [check-interval](#backend-checks) | [time](#time) |  | check |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [config-snippet](#config-snippet) :construction:(dev) | string |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [cookie-persistence](#cookie-persistence) | string |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [dontlognull](#logging) | [bool](#bool) | "true" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [src-ip-header](#src-ip-header) :construction:(dev) | string | "null" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [forwarded-for](#x-forwarded-for) | [bool](#bool) | "true" |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [hard-stop-after](#hard-stop-after) | [time](#time) | "1h" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [http-keep-alive](#http-options) | [bool](#bool) | "true" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [http-server-close](#http-options) | [bool](#bool) | "false" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [ingress.class](#ingress-class) | string |  |  |:white_circle:|:large_blue_circle:|:white_circle:|
| [load-balance](#balance-algorithm) | string | "roundrobin" |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [log-format](#log-format) | string |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [logasap](#logging) | [bool](#bool) | "false" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [maxconn](#maximum-concurrent-connections) | number |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [nbthread](#number-of-threads) | number |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [path-rewrite](#path-rewrite) | string |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [pod-maxconn](#maximum-concurrent-backend-connections) | number |  |  |:white_circle:|:white_circle:|:large_blue_circle:|
| [proxy-protocol](#proxy-protocol) | IPs or CIDRs |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [rate-limit-period](#rate-limit) | [time](#time) | "1s" |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [rate-limit-status-code](#rate-limit) :construction:(dev) | string | "403" |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [rate-limit-requests](#rate-limit) | number |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [rate-limit-size](#rate-limit) | string | "100k" | rate-limit |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [request-capture](#request-capture) | [sample expression](#sample-expression) |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [request-capture-len](#request-capture) | number | 128 |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [request-set-header](#request-set-header) | string |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [response-set-header](#response-set-header) | string |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [send-proxy-protocol](#send-proxy-protocol) :construction:(dev) | ["proxy", "proxy-v1", "proxy-v2", ""] |  |  |:white_circle:|:white_circle:|:large_blue_circle:|
| [server-ca](#server-ca) :construction:(dev) | string |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [server-crt](#server-crt) :construction:(dev) | string |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [server-proto](#server-proto) :construction:(dev) | ["h2"] |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [server-ssl](#server-ssl) | [bool](#bool) | "false" |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [set-host](#set-host) | string |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [scale-server-slots](#backend-scaling) | number | 42 |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [ssl-certificate](#tls-secret) | string |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [ssl-passthrough](#https) | [bool](#bool) | "false" |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [ssl-redirect](#https) | [bool](#bool) | "false" | tls-secret |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [ssl-redirect-code](#https) | [301, 302, 303] | "302" | tls-secret |:large_blue_circle:|:large_blue_circle:|:white_circle:|
| [syslog-server](#logging) | [syslog](#syslog-fields) | "address:127.0.0.1, facility: local0, level: notice" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-check](#timeouts) | [time](#time) |  |  |:large_blue_circle:|:large_blue_circle:|:large_blue_circle:|
| [timeout-client](#timeouts) | [time](#time) | "50s" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-client-fin](#timeouts) | [time](#time) |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-connect](#timeouts) | [time](#time) | "5s" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-http-request](#timeouts) | [time](#time) | "5s" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-http-keep-alive](#timeouts) | [time](#time) | "1m" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-queue](#timeouts) | [time](#time) | "5s" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-server](#timeouts) | [time](#time) | "50s" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-server-fin](#timeouts) | [time](#time) |  |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [timeout-tunnel](#timeouts) | [time](#time) | "1h" |  |:large_blue_circle:|:white_circle:|:white_circle:|
| [whitelist](#access-control) | IPs or CIDRs |  |  |:large_blue_circle:|:large_blue_circle:|:white_circle:|

> :information_source: Annotations have hierarchy: `default` <- `Configmap` <- `Ingress` <- `Service`
>
> Service annotations have highest priority. If they are not defined, controller goes one level up until it finds value.
>
> This is useful if we want, for instance, to change default behaviour, but want to keep default for some service. etc.

### Options

#### Global Options

Global options are set via ConfigMap ([--configmap](controller.md)) annotations.
Depending on the option, it can be in Global or Default HAProxy section.

#### Access Control

- Access control is disabled by default
- Access control can be set for all traffic (annotation on configmap) or for a set of hosts (annotation on ingress)

##### `blacklist`

  Blocks given IP addresses and/or IP address ranges.

  Available on:  `configmap`  `ingress`

Possible values:

- Comma-separated list of IP addresses and/or CIDR ranges

Example:

```yaml
blacklist: "192.168.1.0/24, 192.168.2.100"
```

##### `whitelist`

  Blocks all IP addresses except the whitelisted ones (annotation value).

  Available on:  `configmap`  `ingress`

Possible values:

- Comma-separated list of IP addresses and/or CIDR ranges

Example:

```yaml
whitelist: "192.168.1.0/24, 192.168.2.100"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Authentication

##### `auth-type`


  > :construction: this is only available from next version, currently available in dev build

  Enable the selected Authentication strategy, actually only Basic Auth is supported.

  Available on:  `configmap`  `ingress`

Possible values:

- basic-auth

Example:

```yaml
auth-type: basic-auth
```

##### `auth-secret`


  > :construction: this is only available from next version, currently available in dev build

  Select the Kubernetes Secret resource declaring the user list realm to apply.
  For Basic Authentication the Secret data keys declare the username, related values the matching hashed password.

  > Supported hashing functions: MD5, DES, SHA-256, SHA-512

  Available on:  `configmap`  `ingress`

Possible values:

- Any Kubernetes Secret resource in the same Namespace of the Ingress.

  ```bash
  kubectl create secret generic my-userlist-realm \
    --from-literal=bob=$(echo -n "password" | mkpasswd --stdin --method=md5) \
    --from-literal=alice=$(echo -n "password" | mkpasswd --stdin --method=des) \
    --from-literal=john=$(echo -n "password" | mkpasswd --stdin --method=sha-256) \
    --from-literal=laura=$(echo -n "password" | mkpasswd --stdin --method=sha-512)
  # secret/my-userlist-realm created
  ```

Example:

```yaml
auth-secret: my-userlist-realm
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Backend Checks

##### `check`

  Enables TCP level health checks on pods and attempts a TCP connection periodically.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- true `default`
- false

Example:

```yaml
check: "true"
```

##### `check-http`

  Enables HTTP level health checks on pods and sends an HTTP request periodically. The `check` setting must be true.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- URI to make HTTP requests to, e.g. `/health`
- URI with method, e.g. `HEAD /health`
- URI, method and HTTP version, e.g. `HEAD /health HTTP/1.1`

Example:

```yaml
check: "true"
check-http: "/health"
```

##### `check-interval`

  Sets the interval between health checks when `check` is enabled.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- Integer with time unit suffix (1m = 1 minute, 10s = 10 seconds)

Example:

```yaml
check: "true"
check-interval: "1m"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Backend Scaling

##### `scale-server-slots`

  Sets the number of server slots to provision in order for HAProxy to scale dynamically with no reload. If this number is greater than available endpoints/addresses, the remaining slots will be disabled (put on stand by) and ready to be used. if this number is lower, the remaining endpoints/addresses will be added after scaling HAProxy backend with a reload.

  Available on:  `configmap`

  :information_source: Equivalent old annotations are "servers-increment" and "server-slots"

Possible values:

- Integer value indicating the number of backend servers to provision. Defaults to 42.

Example:

```yaml
server-slots: 75
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Balance Algorithm

##### `load-balance`

  Sets the load-balancing algorithm to use.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- roundrobin `default`
- static-rr
- leastconn
- first
- source
- uri
- url_param
- hdr([name])
- random
- random([draws])
- rdp-cookie
- rdp-cookie([name])

Example:

```yaml
load-balance: "leastconn"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Config Snippet

##### `config-snippet`


  > :construction: this is only available from next version, currently available in dev build

  Defines a group of configuration directives to add directly to the HAProxy configuration. When used in a ConfigMap, directives are added to the `global` section. When used in an Ingress or Service, directives are added to the specific `backend` section.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- One or more valid HAProxy directives

Example (configmap):

```yaml
config-snippet: |
  ssl-default-bind-options no-sslv3 no-tlsv10 no-tlsv11
  ssl-default-bind-ciphers TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:TLS13-CHACHA20-POLY1305-SHA256:EECDH+AESGCM:EECDH+CHACHA20
  tune.ssl.default-dh-param 2048
  tune.bufsize 32768
```

Example (ingress, service):

```yaml
config-snippet: |
  http-send-name-header x-dst-server
  stick-table type string len 32 size 100k expire 30m
  stick on req.cook(sessionid)
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Cookie Persistence

- Configure sticky session via cookie-based persistence.

##### `cookie-persistence`

  Enables persistent connections between a client and a pod by inserting a cookie into the client's browser that is used to remember which backend pod they connected to before.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- A name for the cookie

Example:

```yaml
cookie-persistence: "mycookie"
```

Configuring the cookie can be done in two different ways: 
- Using cookies annotations:
  - `cookie-domain <string>`
  - `cookie-dynamic <"true","false">`
  - `cookie-httponly <"true","false">`
  - `cookie-indirect <"true","false">`
  - `cookie-maxidle <int>`
  - `cookie-maxlife <int>`
  - `cookie-nocache <"true","false">`
  - `cookie-postonly <"true","false">`
  - `cookie-preserve <"true","false">`
  - `cookie-secure <"true","false">`
  - `cookie-type <"rewrite", "insert", "prefix">`
- Using `config-snippet` [annotation](#config-snippet):
  
  ```yaml
  config-snippet: |
      cookie SRV insert indirect nocache              
  ```

More information can be found in the official HAProxy [documentation](https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#4-cookie)

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Hard Stop After

##### `hard-stop-after`

  Defines the maximum time allowed to perform a clean soft-stop.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour)

Example:

```yaml
hard-stop-after: 30s
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Http Options

##### `http-keep-alive`

  Enables HTTP Keep-Alive both from the client to HAProxy and from HAProxy to the backend.

  Available on:  `configmap`

Possible values:

- true `default`
- false

Example:

```yaml
http-keep-alive: "true"
```

##### `http-server-close`

  Disables HTTP Keep-Alive between HAProxy and the backend, while allowing it to stay enabled from the client to HAProxy.

  Available on:  `configmap`

Possible values:

- true
- false `default`

Example:

```yaml
http-server-close: "true"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Https

- SSL offloading/decryption will be automatically enabled if valid SSL certificates are provided.
- Certificates can be provided via [tls-secrets](#tls-secret).

##### `ssl-passthrough`

  Passes SSL/TLS traffic through at Layer 4 directly to the backend service without Layer 7 inspection.

  Available on:  `configmap`  `ingress`  `service`

  :information_source: Traffic is proxied in TCP mode which makes unavailable a number of the controller annotations (requiring HTTP mode).

Possible values:

- true
- false `default`

Example:

```yaml
ssl-passthrough: "true"
```

##### `ssl-redirect`

  Sets whether to redirect traffic from HTTP to HTTPS.

  Available on:  `configmap`  `ingress`

  :information_source: SSL redirection is enabled by default for any ingress resource defined with a TLS section `spec.tls[].secretName`.

  :information_source: Automatic redirects for ingress resources with TLS enabled, can be disabled by setting annotation to "false" in configmap

Possible values:

- true
- false `default`

Example:

```yaml
ssl-redirect: "false"
ssl-certificate: "default/tls-secret"
```

##### `ssl-redirect-code`

  Sets the HTTP status code to use when `ssl-redirect` is true.

  Available on:  `configmap`  `ingress`

Possible values:

- 301
- 302 `default`
- 303

Example:

```yaml
ssl-redirect: "true"
ssl-certificate: "default/tls-secret"
ssl-redirect-code: "301"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Ingress Class

##### `ingress.class`

  Targets an ingress controller by class name for this ingress to use.

  Available on:  `ingress`

  :information_source: Any ingress object which have class specified and its different from one defined in [image arguments](controller.md) will be ignored

  :information_source: default: "" - all ingress objects are monitored

Possible values:

- The ingress class name

Example:

```yaml
ingress.class: "haproxy"

```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Log Format

##### `log-format`

  Sets the log format string to use for HTTP traffic.

  Available on:  `configmap`

  :information_source: Default log-format is: `%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs \"%HM %[var(txn.base)] %HV\"` Which will look like this: `10.244.0.1:5793 [10/Apr/2020:10:32:50.132] https~ test-echo1-8080/SRV_TFW8V 0/0/1/2/3 200 653 - - ---- 1/1/0/0/0 0/0 "GET test.k8s.local/ HTTP/2.0`

Possible values:

- Log format string. More information in [HAProxy documentation](https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#8.2.3)

Example:

```yaml
log-format: "%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs \"%HM %[var(txn.base)] %HV\""
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Logging

##### `dontlognull`

  Do not log connections that sends no data, which can happen with monitoring systems.

  Available on:  `configmap`

Possible values:

- true `default`
- false

Example:

```yaml
dontlognull: "true"
```

##### `logasap`

  Logs request and response data as soon as the server returns a complete set of HTTP response headers, instead of waiting for the response to finish sending all data.

  Available on:  `configmap`

Possible values:

- true
- false `default`

Example:

```yaml
logasap: "true"
```

##### `syslog-server`

  Sets one or more Syslog servers where logs should be forwarded. Each server is placed onto its own line. A line supports the following arguments, which are separated by commas

  Available on:  `configmap`

  :information_source: More information can be found in the [HAProxy documentation](https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#3.1-log)

Possible values:

- address - **Required** - IP address where the syslog server is listening.
- facility - **Required** - One of the 24 syslog facilities (kern, user, mail, daemon, auth, syslog, lpr, news, uucp, cron, auth2, ftp, ntp, audit, alert, con2, local0, local1, local2, local3, local4, local5, local6, local7); In general, you will want to use one of the localX values, since the others are registered for specific types of applications.
- format - Syslog format, one of the following - rfc3164, rfc5424, short, raw. to rfc3164. HAProxy **default** is rfc3164
- length -  Maximum syslog line length. HAProxy **default** is 1024.
- level - Maximum verbosity level to filter outgoing messages; Only messages with a severity at least as important as this level will be sent; Use one of the following (emerg, alert, crit, err, warning, notice, info, debug); Traffic logs are emitted at "info" or higher severity. Haproxy **default** is to send all messages.
- minlevel - Minimum verbosity level. Logs emitted with a more severe level than this one will be capped to this level. HAProxy **default** does not set a minlevel.
- port - Port number where the syslog server is listening. HAProxy **default** is 514.

Example:

```yaml
# a single entry
syslog-server: "address:192.158.1.1, port:514, facility:local0"

# log to stdout
syslog-server: "address:stdout, format: raw, facility:daemon"

# multiple entries
syslog-server: |
  address:127.0.0.1, port:514, facility:local0
  address:192.168.1.1, port:514, facility:local1
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Maximum Concurrent Backend Connections

##### `pod-maxconn`

  Sets the maximum number of concurrent backend connections allowed.

  Available on:  `service`

Possible values:

- An integer setting the maximum number of concurrent backend connections

Example:

```yaml
haproxy.org/pod-maxconn: 30

```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Maximum Concurrent Connections

##### `maxconn`

  Sets the maximum number of concurrent connections that HAProxy will accept.

  Available on:  `configmap`

Possible values:

- An integer setting the allowed number of concurrent connections

Example:

```yaml
maxconn: "2000"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Number Of Threads

##### `nbthread`

  Sets the number of worker threads that the HAProxy process will start. If not set, HAProxy will create a thread for each available processor.

  Available on:  `configmap`

Possible values:

- An integer setting the number of worker threads

Example:

```yaml
nbthread: "8"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Path Rewrite

##### `path-rewrite`

  Replaces the entire URL path with the given value.

  Available on:  `configmap`  `ingress`

Possible values:

- A single path, such as "/", to turn any path into "/"
- Two parameters. A regular expression to match and a path to replace it with.

Example:

```yaml
path-rewrite: "/"                        # replace all paths with /
path-rewrite: (.*) /foo\1                # add the prefix /foo... "/bar?q=1" into "/foo/bar?q=1"
path-rewrite: ([^?]*)(\?(.*))? \1/foo\2  # add the suffix /foo ... "/bar?q=1" into "/bar/foo?q=1"
path-rewrite: /foo/(.*) /\1              # strip /foo ... "/foo/bar?q=1" into "/bar?q=1"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Proxy Protocol

##### `proxy-protocol`

  Enables Proxy Protocol for a comma-delimited list of IP addresses and/or CIDR ranges.

  Available on:  `configmap`

  :information_source: Connection will fail with 400 Bad Request if source IP is in annotation list but no Proxy Protocol data is sent.

Possible values:

- A list of IP addresses and/or CIDR ranges

Example:

```yaml
proxy-protocol: "192.168.1.0/24, 192.168.2.100"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Rate Limit

##### `rate-limit-period`

  Sets the period of time over which requests are tracked for a given source IP address.

  Available on:  `configmap`  `ingress`

Possible values:

- Integer with unit of time (1s = 1 second, 1m = 1 minute); Defaults to 1 second

Example:

```yaml
rate-limit-period: "1m"
```

##### `rate-limit-status-code`


  > :construction: this is only available from next version, currently available in dev build

  Sets the status code to return upon rate limiting has been triggered.

  Available on:  `configmap`  `ingress`

Possible values:

- HTTP status codes; Defaults to 403

Example:

```yaml
rate-limit-status-code: "429"
```

##### `rate-limit-requests`

  Sets the maximum number of requests that will be accepted from a source IP address during the `rate-limit-period`.
  To track the http requests rate, a stick-table named "Ratelimit-<period-in-ms>" will be created. Example, If the rate-limit-period is set to 2s the name of the table will be "Ratelimit-2000".

  Available on:  `configmap`  `ingress`

  :information_source: If this number is exceeded, HAProxy will deny requests with 403 status code

Possible values:

- An integer representing the maximum number of requests to accept

Example:

```yaml
rate-limit-requests: 15
```

##### `rate-limit-size`

  Sets how many source IP addresses to track, after which older entries are replaced by new entries.

  Available on:  `configmap`  `ingress`

  :information_source: If this number is exceeded, older entries will be dropped as new ones come

Possible values:

- An integer defining how many IP addresses to track for rate limiting; Defaults to 100,000

Example:

```yaml
rate-limit-size: 1000000
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Request Capture

##### `request-capture`

  When you include *%hr* in the `log-format` string, which is included in the default log format, it captures custom information in the logs, which you define with this field. For example, you can capture specific cookie values or HTTP header values.

  Available on:  `configmap`  `ingress`

  :information_source: Captures samples of the request using [sample expression](#sample-expression) and log them in HAProxy traffic logs.

Possible values:

- A header value, e.g. `hdr(header-name)`
- A cookie value, e.g. `cookie(cookie-name)`
- Multiple expressions by using a multiline YAML string

Example (configmap):

```yaml
# capture a single value
request-capture: cookie(my-cookie)

# capture multiple values
request-capture: |
  cookie(my-cookie)
  hdr(Host)
  hdr(User-Agent)
```

Example (ingress):

```yaml
# capture a single value
haproxy.org/request-capture: cookie(my-cookie)

# capture multiple values
haproxy.org/request-capture: |
  cookie(my-cookie)
  hdr(Host)
  hdr(User-Agent)
```

##### `request-capture-len`

  Sets how many characters to allocate for fields captured by `request-capture`.

  Available on:  `configmap`  `ingress`

Possible values:

- An integer representing the number of characters for captured fields; Defaults to 128

Example:

```yaml
request-capture: cookie(my-cookie)
request-capture-len: 350
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Request Set Header

##### `request-set-header`

  Sets an HTTP header in the request before it is passed to the backend service.

  Available on:  `configmap`  `ingress`

  :information_source: This sets header before HAProxy does any service/backend dispatch. So in the case you want to change the Host header this will impact HAProxy decision on which service/backend to use (based on matching Host against ingress rules). In order to set the Host header after service selection, use [set-host](#set-host) annotation.

Possible values:

- The name of the field, following by its value, e.g. Ingress-ID abcd123
- Multiple headers can be set using a multiline YAML string

Example (configmap):

```yaml
# single header
request-set-header: Ingress-ID abcd123

# multiple headers
request-set-header: |
  Ingress-ID abcd123
  Another-Header 12345
```

Example (ingress):

```yaml
# single header
haproxy.org/request-set-header: Ingress-ID abcd123

# multiple headers
haproxy.org/request-set-header: |
  Ingress-ID abcd123
  Another-Header 12345
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Response Set Header

##### `response-set-header`

  Sets an HTTP header in the response before it is passed to the client.

  Available on:  `configmap`  `ingress`

Possible values:

- The name of the field, following by its value, e.g. Cache-Control "no-store,no-cache,private"
- Multiple headers can be set using a multiline YAML string

Example (configmap):

```yaml
# single header
response-set-header: Cache-Control "no-store,no-cache,private"

# multiple headers
response-set-header: |
  Cache-Control "no-store,no-cache,private"
  Strict-Transport-Security "max-age=31536000"
```

Example (ingress):

```yaml
# single header
haproxy.org/response-set-header: Cache-Control "no-store,no-cache,private"

# multiple headers
haproxy.org/response-set-header: |
  Cache-Control "no-store,no-cache,private"
  Strict-Transport-Security "max-age=31536000"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Send Proxy Protocol

##### `send-proxy-protocol`


  > :construction: this is only available from next version, currently available in dev build

  Uses the PROXY Protocol when connecting to backend servers.

  Available on:  `service`

Possible values:

- proxy - Uses PROXY v1
- proxy-v1 - Uses PROXY v1
- proxy-v2 - Uses PROXY v2

Example:

```yaml
haproxy.org/send-proxy-protocol: proxy-v2

```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Server Ca

##### `server-ca`


  > :construction: this is only available from next version, currently available in dev build

  value is the path of a secret containing a CA certificate (certificate authority) enabling HAProxy to verify backends certificate via *ca-file* directive. When CA certificate is properly configured this will also sets *verify* directive to *required*.

  Available on:  `service`  `configmap`  `ingress`

  :information_source: The secret must use 'tls.crt' key.

Possible values:

- Secret path following namespace/secretname format.

Example:

```yaml
server-ca: "ns1/ca"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Server Crt

##### `server-crt`


  > :construction: this is only available from next version, currently available in dev build

  value is the path of a secret containing a client certificate that haproxy can provide during a SSL communication with backend servers via *crt* directive.

  Available on:  `service`  `configmap`  `ingress`

  :information_source: The secret must use 'tls.key' and 'tls.crt' keys.

Possible values:

- Secret path following namespace/secretname format.

Example:

```yaml
server-crt: "ns1/client"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Server Proto

##### `server-proto`


  > :construction: this is only available from next version, currently available in dev build

  HTTP/1.1 is the default protocol for backend servers communication. Currently server-proto annotation supports only "h2" value (supporting fcgi is also planned) which forces the HTTP/2 on clear for backend servers.
  When SSL is enabled on the backend, server-proto is ignored and both http/1.1 and http/2 are advertised via ALPN.

  Available on:  `service`  `configmap`  `ingress`

Possible values:

- h2

Example:

```yaml
server-proto: "h2"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Server Ssl

##### `server-ssl`

  Enables SSL to pods.

  Available on:  `configmap`  `ingress`  `service`

  :information_source: Enable HTTP/2 support for backend severs.

  :information_source: Current implementation does not verify server certificates

Possible values:

- true
- false `default`

Example:

```yaml
server-ssl: "true"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Set Host

##### `set-host`

  Sets the Host header to send to backend services.

  Available on:  `configmap`  `ingress`

Possible values:

- The value of the Host header

Example:

```yaml
set-host: "example.local"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Src Ip Header

##### `src-ip-header`


  > :construction: this is only available from next version, currently available in dev build

  Set the source IP from a header rather than the L3 connection.

  Available on:  `configmap`

Possible values:

- any header name

Example:

```yaml
src-ip-header: "True-Client-IP"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Timeouts

##### `timeout-check`

  Sets an additional check timeout, but only after a connection has been already established.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour)

Example:

```yaml
timeout-check: 5s
```

##### `timeout-client`

  Set the maximum inactivity time on the client side.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 50s

Example:

```yaml
timeout-client: 5s
```

##### `timeout-client-fin`

  Sets the inactivity timeout on the client side for half-closed connections.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour)

Example:

```yaml
timeout-client-fin: 5s
```

##### `timeout-connect`

  Sets the maximum time to wait for a connection attempt to a server to succeed.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 5s

Example:

```yaml
timeout-connect: 5s
```

##### `timeout-http-request`

  Sets the maximum allowed time to wait for a complete HTTP request.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 5s

Example:

```yaml
timeout-http-request: 5s
```

##### `timeout-http-keep-alive`

  Sets the maximum allowed time to wait for a new HTTP request to appear.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 1m

Example:

```yaml
timeout-http-keep-alive: 5s
```

##### `timeout-queue`

  Sets the maximum time to wait in the queue for a connection slot to be free.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 5s

Example:

```yaml
timeout-queue: 5s
```

##### `timeout-server`

  Sets the maximum inactivity time on the server side.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 50s

Example:

```yaml
timeout-server: 5s
```

##### `timeout-server-fin`

  Sets the inactivity timeout on the server side for half-closed connections.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour)

Example:

```yaml
timeout-server-fin: 5s
```

##### `timeout-tunnel`

  Set the maximum inactivity time on the client and server side for tunnels.

  Available on:  `configmap`

Possible values:

- An integer with a unit of time (1 second = 1s, 1 minute = 1m, 1h = 1 hour); Defaults to 1h

Example:

```yaml
timeout-tunnel: 30m
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### Tls Secret

- Controller will look into kubernetes tls secrets for valid SSL certificates to configure in HAProxy.
- A default certificate can be provided via controller [argument](controller.md) `--default-ssl-certificate`=\<namespace\>/\<secret\>
- Certificates can be defined in Ingress object: `spec.tls[].secretName`


##### `ssl-certificate`

  Sets the name of the Kubernetes secret that contains both the TLS key and certificate.

  Available on:  `configmap`

  :information_source: this replaces default certificate

Possible values:

- Name of Kubernetes secret

Example:

```yaml
ssl-certificate: "default/tls-secret"
```

- Single certificate secret can contain two items:
  - tls.key
  - tls.crt
- Certificate secret with `rsa` and `ecdsa` certificates:
  - :information_source: only one certificate (rsa/ecdsa) is also acceptable setup
  - rsa.key
  - rsa.crt
  - ecdsa.key
  - ecdsa.crt    


<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***

#### X Forwarded For

##### `forwarded-for`

  Adds the X-Forwarded-For HTTP header to requests to capture and relay the client's source IP address to backend pods.

  Available on:  `configmap`  `ingress`  `service`

Possible values:

- true `default`
- false

Example:

```yaml
forwarded-for: "true"
```

<p align='right'><a href='#available-annotations'>:arrow_up_small: back to top</a></p>

***


### Secrets

#### tls-secret

- define through pod arguments
  - `--default-ssl-certificate`=\<namespace\>/\<secret\>
- Annotation `ssl-certificate` in config map
  - \<namespace\>/\<secret\>
  - this replaces default certificate
- certificate can be defined in Ingress object: `spec.tls[].secretName`
- single certificate secret can contain two items:
  - tls.key
  - tls.crt
- certificate secret with `rsa` and `ecdsa` certificates:
  - :information_source: only one certificate is also acceptable setup
  - rsa.key
  - rsa.crt
  - ecdsa.key
  - ecdsa.crt

### Data types

#### Port

- value between <0, 65535]

#### Sample expression

- Sample expressions/fetches are used to retrieve data from request/response buffer.
- Example:
  - headers: `hdr(header-name)`
  - cookies: `cookie(cookie-name)`
  - Name of the cipher used to offload SSL: `ssl_fc_cipher`
- Sample expressions are covered in depth in [HAProxy documentation](https://cbonte.github.io/haproxy-dconv/2.0/configuration.html#7.3), however many are out of the ingress controller's scope.

#### Time

- number + type
- in milliseconds, "s" suffix denotes seconds
- example: "1s"
